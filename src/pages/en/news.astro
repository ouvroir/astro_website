---
import BaseLayout from '../../layouts/BaseLayout.astro'
import BlogPostPreview from '../../components/BlogPostPreview.astro'

let title = "News"
let slug = "news"
let description = "Blog, announcements, events and newsletter"
let permalink = "https://ouvroir.umontreal.ca/en/news/"
const currentPath = Astro.request.url.pathname;
interface MarkdownFrontmatter {
  publishDate: Date;
  tags: Array<string>
}
// Get all blog posts
let allPosts = Astro.fetchContent<MarkdownFrontmatter>('/src/_blog/*-en.md');
allPosts = allPosts.sort((a, b) => (b.publishDate).valueOf() - (a.publishDate).valueOf());

let tagSet = new Set();
let allTags = [];
allPosts.forEach(p =>{
  p.tags.forEach(t => {
    tagSet.add(t)
  });
});

for (let t of tagSet){
  allTags.push(t)
}
allTags = allTags.sort();


---

<BaseLayout title={title} description={description} permalink={permalink} slug={slug}>
  <div class="container grid-xl">
    <div class="columns">
      <div class="col-12">
        <h1>{title}</h1>
        <p>{description}</p>
      </div>
      <div class="col-9">
          {allPosts.map(p => <BlogPostPreview post={p}/>)}
      </div>
      <div class="col-3" id="tagColumn">
            <h2>Tags</h2>
            {allTags.map(t => {
                return <div class="chip">
                  <a href={`${currentPath}/tags/${t}`}>{t}</a>
                </div>
              }
            )} 
          </div>
    </div>
  </div>
</BaseLayout>
<!-- 
  à par catégorie selon tag
  ├─ Actualités
      ├─ Billets blogue
      ├─ Annonces / événements
      └─ Lettre d’information (v2)

-->

<style>
#tagColumn {
  background-color: lightgray;
  padding-left: 1rem;
}
</style>