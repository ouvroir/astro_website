---
import {
    KNOWN_LANGUAGES, 
    getLanguageFromURL,
    mapGenericToSlug, 
    mapSlugToGeneric,
    mapGenericToText
} from '../data/languages.ts';

let languages = Object.keys(KNOWN_LANGUAGES);

const currentPath = Astro.request.url.pathname;
const lang = currentPath && getLanguageFromURL(currentPath);

const currentSlug = Astro.props.slug
const currentGeneric = mapSlugToGeneric[currentSlug]



console.log("path: "+ currentPath)
console.log("current lang: " + lang)
console.log("current slug: " + currentSlug)

languages.map(l => {
    console.log("langue : " + l)
    var newSlug = currentPath.split('/').map(p => {
            console.log(p)
            var currentLang = KNOWN_LANGUAGES[l]
            if (p == 'fr' || p =='en')
                return currentLang
            else {
                var gen = mapSlugToGeneric[p];
                var langSlug = mapGenericToSlug[gen][currentLang]
                console.log(langSlug)
                return langSlug

            }
        }).join('/');
    
    console.log(newSlug)

}) 




/*
**situation**
lang = fr
currentPath = /fr/actualites/premier-billet
currentSlug = premier-billet

**test1**
console.log(`/en${currentPath.replace(currentSlug,mapGenericToSlug[currentGeneric]['en'] )}`) 
==> /fr//fr/actualites/premier-billet
//doubles the lang


**test2**
languages.map(l => {
    console.log(l)
    console.log(`${currentPath.replace(lang, KNOWN_LANGUAGES[l]).replace(currentSlug,mapGenericToSlug[currentGeneric]['fr'] )}`)
}) 
==> fr
    /fr/actualites/premier-billet
    premier-billet
    Français
    /fr/actualites/premier-billet
    English
    /en/actualites/premier-billet
//need to change actualité to news (two slugs...)

regex: split at / and deal with each part ! 

currentPath.split('/').map(p => {
    console.log(p)
})




*/




---

<style>
    header {
        height: 4rem;
        padding-top: 1rem;   
        padding-bottom: 1rem;   

    }   

    nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .nav-item {
        display: flex;
        flex-grow: 0;
        gap: 0.5em;
        align-items: center;
        justify-content: center;
        /*à définir color: var(--theme-text-lighter)*/
        font-size: 1.5rem;
        padding: 0.5rem;
    }
    .nav-item:hover {
       /*à définir color: var(--theme-accent); */
       color: red
    }
    
    #navlogo {
        width: 2rem;
        height: 2rem;
    }
</style>

<header>
    <nav class="navbar">    
        <section class="navbar-section">
            <a class="nav-item" href={`/${lang}/`}>
                <img id="navlogo" src="/style/img/ouvroir.png">
                <span>Ouvroir</span>
            </a>
        </section>
        <section class="navbar-section">
            <a class="nav-item" href={`/${lang}/${mapGenericToSlug["SERVICES"][lang]}/`}>
                <span>{mapGenericToText["SERVICES"][lang]}</span>
            </a>

            <a class="nav-item" href={`/${lang}/${mapGenericToSlug["PROJETS"][lang]}/`}>
                <span>{mapGenericToText["PROJETS"][lang]}</span>
            </a>

            <a class="nav-item" href={`/${lang}/${mapGenericToSlug["BLOG"][lang]}/`}>
                <span>{mapGenericToText["BLOG"][lang]}</span>
            </a>

            <a class="nav-item" href={`/${lang}/${mapGenericToSlug["INFO"][lang]}/`}>
                <span><i class="fas fa-info-circle"></i></span>
            </a>
            <div class="nav-item">
                {languages.map(l => {
                    
                    var newSlug = currentPath.split('/').map(p => {
                        var currentLang = KNOWN_LANGUAGES[l]
                        if (p == 'fr' || p =='en')
                            return currentLang
                        else {
                            var gen = mapSlugToGeneric[p];
                            var langSlug = mapGenericToSlug[gen][currentLang]
                            console.log(langSlug)
                            return langSlug

                        }
                    }).join('/');

                    return <a class="langChange" href={newSlug}>{KNOWN_LANGUAGES[l]}</a>
                })}
            </div>
        </section>
    </nav>
</header>
